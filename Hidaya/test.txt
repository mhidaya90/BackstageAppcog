import express from 'express';
import request from 'supertest';
import { createRouter } from './router';

describe('Router', () => {
  let app: express.Express;
  const mockBitriseService = {
    getBuild: jest.fn().mockResolvedValue({ id: '123', status: 'success' }),
  };

  beforeAll(async () => {
    app = express();
    const router = await createRouter({ bitriseService: mockBitriseService });
    app.use(router);
  });

  it('GET /bitrise/build/:appSlug should return build info', async () => {
    const response = await request(app).get('/bitrise/build/test-app');
    expect(response.status).toBe(200);
    expect(response.body).toEqual({ id: '123', status: 'success' });
    expect(mockBitriseService.getBuild).toHaveBeenCalledWith('test-app');
  });
});
