import { startTestBackend } from '@backstage/backend-test-utils';
import { coreServices } from '@backstage/backend-plugin-api';
import { flowsourceBitrisePlugin } from './plugin';
import { catalogServiceRef } from '@backstage/plugin-catalog-node';
import express from 'express';

describe('flowsourceBitrisePlugin', () => {
  it('should register and initialize the plugin correctly', async () => {
    const mockUse = jest.fn();
    const mockRouter = { use: mockUse } as unknown as express.Router;

    await startTestBackend({
      features: [
        flowsourceBitrisePlugin,
      ],
      services: [
        [coreServices.httpRouter, async () => mockRouter],
        [coreServices.logger, async () => console],
        [catalogServiceRef, async () => ({})],
      ],
    });

    expect(mockUse).toHaveBeenCalled();
  });
});
