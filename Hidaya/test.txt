import { startTestBackend } from '@backstage/backend-test-utils';
import { coreServices } from '@backstage/backend-plugin-api';
import { catalogServiceRef } from '@backstage/plugin-catalog-node';
import { flowsourceBitrisePlugin } from './plugin';

describe('flowsourceBitrisePlugin', () => {
  it('should initialize plugin and register router', async () => {
    const mockUse = jest.fn();
    const mockLogger = { info: jest.fn(), error: jest.fn(), warn: jest.fn(), debug: jest.fn() };

    await startTestBackend({
      features: [
        flowsourceBitrisePlugin,
      ],
      services: [
        { service: coreServices.logger, factory: async () => mockLogger },
        { service: coreServices.httpRouter, factory: async () => ({ use: mockUse }) },
        { service: catalogServiceRef, factory: async () => ({}) },
      ],
    });

    expect(mockUse).toHaveBeenCalled();
  });
});
