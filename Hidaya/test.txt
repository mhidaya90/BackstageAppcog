import request from 'supertest';
import express from 'express';
import { createRouter } from './router'; // Adjust the path if needed

describe('Router', () => {
  let app;
  let mockBitriseService;

  beforeEach(async () => {
    mockBitriseService = {
      getBuild: jest.fn().mockResolvedValue({ id: '123', status: 'success' }),
    };

    const router = await createRouter({ bitriseService: mockBitriseService });
    app = express();
    app.use(router);
  });

  it('GET /bitrise/build/:appSlug should return build info', async () => {
    const response = await request(app).get('/bitrise/build/testAppSlug');
    expect(response.status).toBe(200);
    expect(response.body).toEqual({ id: '123', status: 'success' });
    expect(mockBitriseService.getBuild).toHaveBeenCalledWith('testAppSlug');
  });
});
