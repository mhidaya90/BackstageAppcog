import { startTestBackend } from '@backstage/backend-test-utils';
import { coreServices } from '@backstage/backend-plugin-api';
import { catalogServiceRef } from '@backstage/plugin-catalog-node';
import { flowsourceBitrisePlugin } from './plugin';

describe('flowsourceBitrisePlugin', () => {
  it('should register and initialize the plugin correctly', async () => {
    const mockUse = jest.fn();

    await startTestBackend({
      features: [flowsourceBitrisePlugin],
      serviceOverrides: {
        [coreServices.logger]: async () => ({
          info: jest.fn(),
          error: jest.fn(),
          warn: jest.fn(),
          debug: jest.fn(),
        }),
        [coreServices.httpRouter]: async () => ({
          use: mockUse,
        }),
        [catalogServiceRef]: async () => ({}),
      },
    });

    expect(mockUse).toHaveBeenCalled();
  });
});
